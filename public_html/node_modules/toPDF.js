var fs = require('fs'),
        path = require('path'),
        spawn = require('child_process').spawn;



exports.toPDF = function(req, res) {
    var decktape = __dirname + '\\decktape\\decktape.js';
    var phantomjs = __dirname + '\\phantomjs.exe';

    var parentDir = path.resolve(process.cwd(), '.');

    var buf = new Buffer(req.body.slides);
    var slides64 = buf.toString("base64");

    var pdf_name = 'public/cache/' + req.body.title + '.pdf';

    var childArgs = [
        decktape,
        "file:///" + parentDir + "/public/app/components/reveal.js/index.html?slides=" + slides64,
        pdf_name
    ];

    var child = spawn(phantomjs, childArgs);

    child.stdout.on('data', function(data) {
        console.log('stdout: ' + data);
    });

    child.stderr.on('data', function(data) {
        console.log('stderr: ' + data);
    });

    child.on('close', function(code) {
        console.log('child process exited with code ' + code);
        res.send({end_code: code});
    });
};